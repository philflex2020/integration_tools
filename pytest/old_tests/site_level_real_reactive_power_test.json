{
    "name": "Site Level Command - Site Real and Reactive Power Test",
    "tests": [
        {
            "id": "0",
            "name": "Initial State - Site Started, All ESS Units Running, POI Limits Disabled, and Site under UI Control",
            "testbeds": [
                "0"
            ],
            "variables": [
                {
                    "var": "ess_id",
                    "description": "range(1, 74, 1)",
                    "type": "string",
                    "size": 2
                }
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/site/operation/disable_flag",
                    "value": true
                },
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/site/operation/disable_flag",
                    "value": false
                },
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/site/operation/enable_flag_ui",
                    "value": true
                },
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/standalone_power/poi_limits_enable",
                    "value": false
                },
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "comments": "Multiple Inputs: UI Controls Enable",
                    "uri": "/site/configuration/reserved_bool_11",
                    "value": true
                },
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/site/input_sources/ui",
                    "value": true
                },
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/assets/ess/ess_<ess_id>/start",
                    "value": true
                },
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/summary/export_target_mode_enable_flag",
                    "value": true
                },
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/summary/reactive_setpoint_mode_enable_flag",
                    "value": true
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "waiting": 5,
                    "uri": "/site/operation/site_status",
                    "value": [
                        {
                            "value": "Running - Grid",
                            "name": "Site Controller Status",
                            "unit": "",
                            "scaler": 1,
                            "enabled": true,
                            "type": "string",
                            "ui_type": "status"
                        }
                    ]
                },
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "waiting": 5,
                    "uri": "/assets/ess/ess_<ess_id>/status",
                    "value": [
                        {
                            "naked_value": "Grid power supply running"
                        }
                    ]
                },
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "waiting": 5,
                    "uri": "/site/operation/enable_flag_ui",
                    "value": [
                        {
                            "value": false,
                            "name": "Start Site: UI",
                            "unit": "",
                            "scaler": 1,
                            "enabled": true,
                            "type": "enum_button",
                            "ui_type": "control",
                            "options": [
                                {
                                    "name": "Start Site",
                                    "return_value": true
                                }
                            ]
                        }
                    ]
                },
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/assets/ess/summary/num_ess_available",
                    "value": [
                        {
                            "naked_value": 74
                        }
                    ]
                },
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/features/standalone_power/poi_limits_enable",
                    "value": [
                        {
                            "value": false,
                            "name": "Enable POI Limits",
                            "unit": "",
                            "scaler": 1,
                            "enabled": true,
                            "type": "enum_slider",
                            "ui_type": "control",
                            "options": [
                                {
                                    "name": "False Case Not Used",
                                    "return_value": false
                                },
                                {
                                    "name": "POI Limit Protection",
                                    "return_value": true
                                }
                            ]
                        }
                    ]
                },
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "waiting": 5,
                    "uri": "/site/operation/export_target_mode_enable_flag",
                    "value": [
                        {
                            "value": false,
                            "name": "Site Export Target Mode Enable",
                            "unit": "",
                            "scaler": 1,
                            "enabled": true,
                            "type": "enum_slider",
                            "ui_type": "control",
                            "options": [
                                {
                                    "name": "False Case Not Used",
                                    "value": false
                                },
                                {
                                    "name": "Site Export Target Mode Enable",
                                    "value": true
                                }
                            ]
                        }
                    ]
                },
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "waiting": 5,
                    "uri": "/site/operation/reactive_setpoint_mode_enable_flag",
                    "value": [
                        {
                            "value": false,
                            "name": "Reactive Power Setpoint Mode Enable",
                            "unit": "",
                            "scaler": 1,
                            "enabled": true,
                            "type": "enum_slider",
                            "ui_type": "control",
                            "options": [
                                {
                                    "name": "False Case Not Used",
                                    "value": false
                                },
                                {
                                    "name": "Reactive Power Setpoint Mode Enable",
                                    "value": true
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "id": "1",
            "name": "Give a real power command of 50MW",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/active_power/export_target_kW_cmd",
                    "value": 50000000
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/features/active_power/feeder_actual_kW",
                    "tolerance": "2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": 50000000
                        }
                    ]
                }
            ]
        },
        {
            "id": "2",
            "name": "Give a real power command of 100MW",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/active_power/export_target_kW_cmd",
                    "value": 100000000
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/features/active_power/feeder_actual_kW",
                    "tolerance": "2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": 100000000
                        }
                    ]
                }
            ]
        },
        {
            "id": "3",
            "name": "Give a real power command of 225MW",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/active_power/export_target_kW_cmd",
                    "value": 225000000
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/features/active_power/feeder_actual_kW",
                    "tolerance": "2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": 225000000
                        }
                    ]
                }
            ]
        },
        {
            "id": "4",
            "name": "Give a real power command of 300MW - verify that real power is limited to 234 MW",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/active_power/export_target_kW_cmd",
                    "value": 300000000
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/features/active_power/feeder_actual_kW",
                    "tolerance": "2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": 234000000
                        }
                    ]
                }
            ]
        },
        {
            "id": "5",
            "name": "Give a real power command of -50MW",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/active_power/export_target_kW_cmd",
                    "value": -50000000
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/features/active_power/feeder_actual_kW",
                    "tolerance": "-2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": -50000000
                        }
                    ]
                }
            ]
        },
        {
            "id": "6",
            "name": "Give a real power command of -100MW",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/active_power/export_target_kW_cmd",
                    "value": -100000000
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/features/active_power/feeder_actual_kW",
                    "tolerance": "-2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": -100000000
                        }
                    ]
                }
            ]
        },
        {
            "id": "7",
            "name": "Give a real power command of -225MW",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/active_power/export_target_kW_cmd",
                    "value": -225000000
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/features/active_power/feeder_actual_kW",
                    "tolerance": "-2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": -225000000
                        }
                    ]
                }
            ]
        },
        {
            "id": "8",
            "name": "Give a real power command of -300MW - verify that real power is limited to -234 MW",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/active_power/export_target_kW_cmd",
                    "value": -300000000
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/features/active_power/feeder_actual_kW",
                    "tolerance": "-2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": -234000000
                        }
                    ]
                }
            ]
        },
        {
            "id": "9",
            "name": "Give a real power command of 0MW",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/active_power/export_target_kW_cmd",
                    "value": 0
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/features/active_power/feeder_actual_kW",
                    "tolerance": "2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": 0
                        }
                    ]
                }
            ]
        },
        {
            "id": "10",
            "name": "Give a reactive power command of 10MVAR",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/reactive_power/ess_kVAR_cmd",
                    "value": 10000000
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/assets/ess/summary/ess_actual_kVAR",
                    "tolerance": "2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": 10000000
                        }
                    ]
                }
            ]
        },
        {
            "id": "11",
            "name": "Give a reactive power command of 40MVAR",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/reactive_power/ess_kVAR_cmd",
                    "value": 40000000
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/assets/ess/summary/ess_actual_kVAR",
                    "tolerance": "2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": 40000000
                        }
                    ]
                }
            ]
        },
        {
            "id": "12",
            "name": "Give a reactive power command of 100MVAR",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/reactive_power/ess_kVAR_cmd",
                    "value": 100000000
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/assets/ess/summary/ess_actual_kVAR",
                    "tolerance": "2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": 100000000
                        }
                    ]
                }
            ]
        },
        {
            "id": "13",
            "name": "Give a reactive power command of 150MVAR - verify that reactive power is limited to 106MVAR",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/reactive_power/ess_kVAR_cmd",
                    "value": 150000000
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/assets/ess/summary/ess_actual_kVAR",
                    "tolerance": "2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": 150000000
                        }
                    ]
                }
            ]
        },
        {
            "id": "14",
            "name": "Give a reactive power command of -10MVAR",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/reactive_power/ess_kVAR_cmd",
                    "value": -10000000
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/assets/ess/summary/ess_actual_kVAR",
                    "tolerance": "-2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": -10000000
                        }
                    ]
                }
            ]
        },
        {
            "id": "15",
            "name": "Give a reactive power command of -40MVAR",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/reactive_power/ess_kVAR_cmd",
                    "value": -40000000
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/assets/ess/summary/ess_actual_kVAR",
                    "tolerance": "-2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": -40000000
                        }
                    ]
                }
            ]
        },
        {
            "id": "16",
            "name": "Give a reactive power command of -100MVAR",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/reactive_power/ess_kVAR_cmd",
                    "value": -100000000
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/assets/ess/summary/ess_actual_kVAR",
                    "tolerance": "-2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": -100000000
                        }
                    ]
                }
            ]
        },
        {
            "id": "17",
            "name": "Give a reactive power command of -150MVAR - verify that reactive power is limited to -106MVAR",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/reactive_power/ess_kVAR_cmd",
                    "value": -150000000
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/assets/ess/summary/ess_actual_kVAR",
                    "tolerance": "-2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": -150000000
                        }
                    ]
                }
            ]
        },
        {
            "id": "18",
            "name": "Give a reactive power command of 0MVAR",
            "testbeds": [
                "0"
            ],
            "steps": [
                {
                    "controller": "site_controller",
                    "action": "fims_set",
                    "uri": "/features/reactive_power/ess_kVAR_cmd",
                    "value": 0
                }
            ],
            "result": [
                {
                    "controller": "site_controller",
                    "action": "fims_get",
                    "uri": "/assets/ess/summary/ess_actual_kVAR",
                    "tolerance": "2000000",
                    "waiting": 5,
                    "value": [
                        {
                            "naked_value": 0
                        }
                    ]
                }
            ]
        }
    ],
    "testbeds": [
        {
            "id": "0",
            "name": "Local Site Docker",
            "controllers": [
                {
                    "id": "site_controller",
                    "name": "site_controller",
                    "user": "flexgen",
                    "pass": "flexgen1A!"
                },
                {
                    "id": "twins",
                    "name": "twins",
                    "user": "",
                    "pass": ""
                }
            ]
        }
    ]
}